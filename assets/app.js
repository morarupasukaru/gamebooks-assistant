!function(){"use strict";String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.substr(t,e.length)===e})}(),function(e){"use strict";e._=e._||{};var t=e._;t.config=t.config||{};var n=t.config;n.storageKeys={savedLanguage:"savedLanguage",gamebooksList:"gamebooksList",debugEnabled:"debugEnabled",currentScreenId:"currentScreenId"},n.languages={default:"en",supported:["fr","en"]},n.texts={errorFeatureNotImplemented:"error-feature-not-implemented",errorLocalstorageUnavailable:"error-localstorage-unavailable",modalTitlePrefix:"modal-title-",modalTitleError:"modal-title-error",fr:"Francais",en:"English"},n.translatedTexts={en:{},fr:{}},n.translatedTexts.en[n.texts.errorLocalstorageUnavailable]="LocalStorage is required by the application but is unavailable.",n.translatedTexts.fr[n.texts.errorLocalstorageUnavailable]="LocalStorage est requis à l'application mais n'est pas disponible.",n.translatedTexts.en[n.texts.errorFeatureNotImplemented]="Functionality is not yet implemented.",n.translatedTexts.fr[n.texts.errorFeatureNotImplemented]="La fonctionnalité n'est pas encore implémentée.",n.translatedTexts.en[n.texts.modalTitleError]="ERROR",n.translatedTexts.fr[n.texts.modalTitleError]="ERREUR"}(this),function(e){"use strict";e._=e._||{};var t=e._;t.dom=t.dom||{};var n=t.dom;n.appendHtml=function(e,t){var n=document.createElement("div");for(n.innerHTML=t;n.children.length>0;)e.appendChild(n.children[0])},n.display=function(e){var t=document.getElementById(e);return!!t&&(t.classList.remove("hidden"),!0)},n.hide=function(e){var t=document.getElementById(e);return!!t&&(t.classList.add("hidden"),!0)},n.displayAllByCssSelector=function(e){var t=document.querySelectorAll(e);if(t)for(var n=0;n<t.length;n++)t[n].classList.remove("hidden")},n.hideAllByCssSelector=function(e){var t=document.querySelectorAll(e);if(t)for(var n=0;n<t.length;n++)t[n].classList.add("hidden")},n.setPlaceholderText=function(e,n,o){var i=document.getElementById(e);"fr"===t.data.getLanguage()?i.setAttribute("placeholder",n):i.setAttribute("placeholder",o)},n.setText=function(e,t,n){var o=document.getElementById(e);o&&(o.setAttribute("data-fr",t),o.setAttribute("data-en",n))},n.setHrefOfScreen=function(e,n){var o=document.getElementById(e);if(o){var i=t.route.getScreenUrl(n);o.setAttribute("href",i)}}}(this),function(e){"use strict";e._=e._||{};var t=e._;t.msg=t.msg||{};var n=t.msg;n.ids={modal:"modal-id",title:"modal-title-id",text:"modal-text-id"},n.errorUnsupportedFeature=function(){this._displayMessage("error",t.config.texts.errorFeatureNotImplemented)},n.error=function(e){this._displayMessage("error",e)},n._displayMessage=function(e,n){var o=t.i18n.currentLanguage,i=t.config.translatedTexts[o][n];i||(i=n);var r=t.config.translatedTexts[o][t.config.texts.modalTitlePrefix+e];window.document.getElementById(this.ids.title).innerText=r,window.document.getElementById(this.ids.text).innerText=i,window.document.getElementById(this.ids.modal).style.display="block"},n.closeModal=function(){window.document.getElementById(this.ids.modal).style.display="none"},e.addEventListener&&e.addEventListener("error",function(e){console.log(e.error.toString())})}(this),function(e){"use strict";e._=e._||{};var t=e._;t.data=t.data||{};var n=t.data,o={},i=function(){void 0===n.isLocalStorageAvailable&&(n.isLocalStorageAvailable=function(){try{var t=e.localStorage,n="__storage_test__";return t.setItem(n,n),t.removeItem(n),!0}catch(e){return!1}}())};n.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})};var r=function(e){if(i(),!n.isLocalStorageAvailable)return o[e];var t=localStorage.getItem(e);if(null==t||"undefined"===t)return null;try{return JSON.parse(t)}catch(e){return t}},a=function(e){var t={},n=Object.keys(e);n=n.sort();for(var o=0;o<n.length;o++){var i=n[o];t[i]=r(i)}return t};n.getAllData=function(){return i(),n.isLocalStorageAvailable?a(localStorage):a(o)};var s=function(e,t){i(),n.isLocalStorageAvailable?"string"==typeof t?localStorage.setItem(e,t):localStorage.setItem(e,JSON.stringify(t)):o[e]=t};n.getLanguage=function(){return r(t.config.storageKeys.savedLanguage)},n.setLanguage=function(e){s(t.config.storageKeys.savedLanguage,e)},n.getGamebooksList=function(){return r(t.config.storageKeys.gamebooksList)},n.setGamebooksList=function(e){s(t.config.storageKeys.gamebooksList,e)},n.isDebugEnabled=function(){return r(t.config.storageKeys.debugEnabled)},n.setDebugEnabled=function(e){s(t.config.storageKeys.debugEnabled,e)},n.getCurrentScreenId=function(){return r(t.config.storageKeys.currentScreenId)},n.setCurrentScreenId=function(e){s(t.config.storageKeys.currentScreenId,e)};var d=!1;n.initialize=function(){d||(i(),n.isLocalStorageAvailable||t.msg.error(t.config.texts.errorLocalstorageUnavailable),d=!0)}}(this),function(e){"use strict";e._=e._||{};var t=e._;t.ajax=t.ajax||{},t.ajax.loadJson=function(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var e=JSON.parse(this.responseText);t(e)}},n.open("GET",e,!0),n.send()}}(this),function(e){"use strict";e._=e._||{};var t=e._;t.i18n=t.i18n||{};var n=t.i18n;n.setLanguage=function(e){if(this.currentLanguage!==e){this.currentLanguage=e,t.data.setLanguage(e),document.getElementsByTagName("html")[0].lang=e,document.getElementById("footer-lang-"+e+"-id").classList.add("hidden");for(var n=0;n<t.config.languages.supported.length;n++)e!==t.config.languages.supported[n]&&document.getElementById("footer-lang-"+t.config.languages.supported[n]+"-id").classList.remove("hidden");this._forceReloadStylesheetIfNeeded(e);var o=t.route.getCurrentScreen();o&&o.onLanguageChange&&o.onLanguageChange(e)}},n._forceReloadStylesheetIfNeeded=function(e){var t=document.getElementById("i18n-test-id"),n=window.getComputedStyle(t,":before").getPropertyValue("content");n&&n==='"'+e+'"'||this._forceReloadStylesheet(e)},n._forceReloadStylesheet=function(e){var n="i18n-forcecssreload-id",o=document.getElementById(n),i=n+".css?"+e;o?o.href=i:t.dom.appendHtml(document.getElementsByTagName("head")[0],'<link id="'+n+'" rel="stylesheet" href="'+i+'">')};var o=!1;n.initialize=function(){if(!o){var e=t.data.getLanguage();if(e)this.setLanguage(e);else{for(var n,i=navigator.languages&&navigator.languages[0]||navigator.language||navigator.userLanguage,r=0;r<t.config.languages.supported.length;r++){var a=t.config.languages.supported[r];if(i===a||i.startsWith(a+"-")){n=a;break}}n||(n=this.defaultLanguage),this.setLanguage(n)}o=!0}}}(this),function(e){"use strict";var t=e._;t.footer=t.footer||{};for(var n=t.footer,o=function(e,t){var n=document.getElementById("footer-lang-id"),o=document.createElement("a");o.setAttribute("id","footer-lang-"+e+"-id"),o.setAttribute("hreflang",e),o.setAttribute("onClick","_.i18n.setLanguage('"+e+"');"),o.innerHTML='<span class="icon icon-globe"></span><span class="spanLang">&nbsp;'+t+"&nbsp;</span>";var i=n.firstChild;n.insertBefore(o,i)},i=t.config.languages.supported,r=0;r<i.length;r++)o(i[r],t.config.texts[i[r]]);n.displayHomepageFooter=function(){t.dom.display("footer-github-id"),t.dom.hide("footer-left-id"),t.dom.hide("footer-home-id")},n.displayChildFooter=function(){t.dom.display("footer-left-id"),t.dom.display("footer-home-id"),t.dom.hide("footer-github-id")};var a=!1;n.initialize=function(){a||(t.dom.setHrefOfScreen("footer-home-id","home"),t.dom.display("footer-id"),a=!0)}}(this),function(e){"use strict";e._=e._||{};var t=e._,n=!1;t.screens=t.screens||[],t.screens.push({id:"home",routeUrl:[],initialize:function(){n||(document.getElementById("home-showdata-id").href=t.route.getScreenUrl("dataOfApplication"),n=!0)},display:function(){t.dom.display("home-id")&&t.footer.displayHomepageFooter()},hide:function(){t.dom.hide("home-id")}})}(this),function(e){"use strict";e._=e._||{};var t=e._,n=!1;t.screens=t.screens||[],t.screens.push({id:"pageNotFound",routeUrl:["404"],initialize:function(){n||(t.dom.setHrefOfScreen("404-back-id","home"),n=!0)},display:function(){t.dom.display("404-id")&&t.footer.displayChildFooter()},hide:function(){t.dom.hide("404-id")}})}(this),function(e){"use strict";e._=e._||{};var t=e._,n=function(){t.dom.display("data-id")&&t.footer.displayChildFooter()},o=function(){t.dom.hide("data-id")},i=!1,r=function(){i||(i=!0)},a=function(e){document.getElementById("data-code-id").innerHTML=e};t.screens=t.screens||[],t.screens.push({id:"dataOfGamebooks",routeUrl:["data-gamebooks"],initialize:function(){r(),t.dom.setText("data-title-id","Données de la liste des livres-jeux","Gamebooks list data"),t.dom.setText("data-back-id","Retour à la liste des livres-jeux","Back to gamebooks list"),a(JSON.stringify(t.data.getGamebooksList(),null,"\t")),t.dom.setHrefOfScreen("data-back-id","gamebooks")},display:n,hide:o}),t.screens.push({id:"dataOfApplication",routeUrl:["data-application"],initialize:function(){r(),t.dom.setText("data-title-id","Données de l'application","Data of the application"),t.dom.setText("data-back-id","Retour à l'acceuil","Back to home"),a(JSON.stringify(t.data.getAllData(),null,"\t")),t.dom.setHrefOfScreen("data-back-id","home")},display:n,hide:o})}(this),function(e){"use strict";e._=e._||{};var t=e._;t.screens=t.screens||[],t.screens.push({id:"gamebook",routeUrl:["gamebook"],initialize:function(){},display:function(){t.dom.display("book-id")&&t.footer.displayChildFooter()},hide:function(){t.dom.hide("book-id")}})}(this),function(e){"use strict";e._=e._||{};var t,n=e._,o="books-choose-id",i=!1;n.screens=n.screens||[],n.screens.push({id:"gamebooks",routeUrl:["gamebooks"],initialize:function(){if(document.getElementById(o)){var e=n.data.getGamebooksList();!e||t&&t===e.version||(function(e){if(e){var t,i,r,a=[],s={};for(t=0;t<e.length;t++)r=e[t].serie,-1===a.indexOf(r)&&(a.push(r),s[r]=[]),s[r].push(e[t]);for(a.sort(),t=0;t<a.length;t++){r=a[t],g=r,n.dom.appendHtml(document.getElementById(o),'<div class="pure-u-1"><h2 class="books-serie">'+g+"</h2></div>");var d=s[r];for(d=d.sort(function(e,t){return e.order-t.order}),i=0;i<d.length;i++)l=d[i],u=d.length,c=void 0,l&&(c=u>2?" pure-u-lg-1-3":u>1?" pure-u-lg-1-2":"",n.dom.appendHtml(document.getElementById(o),'<div class="pure-u-1'+c+'"><div class="margin-right"><a class="button u-full-width books-book" href="'+n.route.getScreenUrl("gamebook")+'">'+l.name+"</a></div></div>"))}}var l,u,c,g}(e.gamebooks),t=e.version),i||(n.dom.setHrefOfScreen("books-showdata-id","dataOfGamebooks"),n.dom.setHrefOfScreen("books-add-id","newGamebook"),i=!0)}},display:function(){n.dom.display("books-id")&&n.footer.displayChildFooter()},hide:function(){n.dom.hide("books-id")}})}(this),function(e){"use strict";e._=e._||{};var t=e._,n=function(){t.dom.setPlaceholderText("book-new-title-id","Titre du livre-jeu","Title of the gamebook"),t.dom.setPlaceholderText("book-new-serie-id","Serie du livre-jeu","Serie of the gamebook")},o=!1;t.screens=t.screens||[],t.screens.push({id:"newGamebook",routeUrl:["gamebook","new"],initialize:function(){o||(n(),t.dom.setHrefOfScreen("book-new-cancel-id","gamebooks"),o=!0)},display:function(){t.dom.display("book-new-id")&&t.footer.displayChildFooter(),document.getElementById("book-new-title-id").value="",document.getElementById("book-new-serie-id").value="",document.getElementById("book-new-title-id").focus()},hide:function(){t.dom.hide("book-new-id")},onLanguageChange:n,onSubmit:function(){t.route.setCurrentScreenWithId("gamebook")}})}(this),function(e){"use strict";e._=e._||{};var t=e._;t.route=t.route||{};var n=t.route,o=function(e){var t={};if(e){e.startsWith("?")&&(e=e.substr(1,e.length));var n,o=e.split("&");if(o)for(n=0;n<o.length;n++){var i=o[n].split("="),r=i[0],a=null;i.length>1&&(a=i[1]),t[r]=a}}return t},i=function(){var t,n,i,r=(t={},e.location&&e.location.search&&(t=o(e.location.search)),t),a=function(){var t={};if(e.location&&e.location.hash){var n=e.location.hash.split("?");n.length>1&&(t=o(n[1]))}return t}();return n=r,i=a,Object.keys(i).forEach(function(e){n[e]=i[e]}),n},r=function(e){var n=".only-visible-by-debug";e?t.dom.displayAllByCssSelector(n):t.dom.hideAllByCssSelector(n)},a={"http://morarupasukaru.github.io":"/gamebooks-assistant#"};n.getHomeUrl=function(){var t=e.location.host,n=a[t];return n||(n="#"),n},n.getScreenUrl=function(e){var o;if(t.screens)for(var i=n.getHomeUrl(),r=0;r<t.screens.length;r++){var a=t.screens[r];if(a.id===e){o=i+a.routeUrl.join("/");break}}return o};var s=function(e){if(t.screens)for(var n=0;n<t.screens.length;n++){var o=t.screens[n],i=o.routeUrl;if(Array.isArray(i)||(i=[i]),i.length===e.length){for(var r=!0,a=0;a<i.length;a++)if(i[a]!==e[a]){r=!1;break}if(r)return o}}return null},d=function(e){if(t.screens)for(var n=0;n<t.screens.length;n++){var o=t.screens[n];if(o.id===e)return o}return null};n.getCurrentScreen=function(){var e,n=t.data.getCurrentScreenId();return n&&(e=d(n)),e};var l=s(["404"]);n.setCurrentScreen=function(e){var o=n.getCurrentScreen();o&&e.id!==o.id?(e.initialize(),o.hide(),e.display()):(e.initialize(),e.display()),t.data.setCurrentScreenId(e.id)},n.setCurrentScreenWithId=function(e){var o=d(e);o&&(window.location.assign(t.route.getScreenUrl(e)),n.setCurrentScreen(o))};var u=function(){var t,o,i,r,a,d=s((t=[],e.location&&e.location.hash&&(o=e.location.hash,a=[],o&&-1!==o.indexOf("#")&&(r=-1!==(i=o.startsWith("#")?o.substring(1):o.split("#")[1]).indexOf("?")?i.startsWith("?")?null:i.split("?")[0]:i)&&(a=r.split("/")),t=a),t));d||(d=l),n.setCurrentScreen(d)},c=function(e){var n,o,a,s,d;n=e,a=i(),s=Object.keys(a),d=!!t.data.isDebugEnabled(),-1!==s.indexOf("debugEnabled")?(o=!0,t.data.setDebugEnabled(o)):-1!==s.indexOf("debugDisabled")&&(o=!1,t.data.setDebugEnabled(o)),(n||void 0!==o)&&r(void 0!==o&&d!==o?!!o:d),u()};e.onhashchange=function(){c()};var g=!1;n.initialize=function(){g||(c(!0),g=!0)}}(this),function(e){"use strict";e._=e._||{};var t=e._;t.form=t.form||{};var n=t.form;n.onSubmit=function(){var e=t.route.getCurrentScreen();e&&e.onSubmit&&e.onSubmit()},n.submit=function(){document.getElementById("submit-id").click()}}(this),function(e){"use strict";var t=e._;t.dom.hide("nojs-id"),t.i18n.initialize(),t.data.initialize(),t.footer.initialize(),t.route.initialize()}(this);