var i;if(function(){"use strict";String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.substr(t,e.length)===e})}(),function(e){"use strict";e._=e._||{},e._.config=e._.config||{};var t=e._.config;t.storageKeys={savedLanguage:"savedLanguage"},t.languages={default:"en",supported:["fr","en"]},t.texts={errorFeatureNotImplemented:"error-feature-not-implemented",errorLocalstorageUnavailable:"error-localstorage-unavailable",modalTitlePrefix:"modal-title-",modalTitleError:"modal-title-error",fr:"Francais",en:"English"},t.translatedTexts={en:{},fr:{}},t.translatedTexts.en[t.texts.errorLocalstorageUnavailable]="LocalStorage is required by the application but is unavailable",t.translatedTexts.fr[t.texts.errorLocalstorageUnavailable]="LocalStorage est requis à l'application mais n'est pas disponible",t.translatedTexts.en[t.texts.errorFeatureNotImplemented]="Functionality is not yet implemented.",t.translatedTexts.fr[t.texts.errorFeatureNotImplemented]="La fonctionnalité n'est pas encore implémentée.",t.translatedTexts.en[t.texts.modalTitleError]="ERROR",t.translatedTexts.fr[t.texts.modalTitleError]="ERREUR"}(this),function(e){"use strict";e._=e._||{},e._.dom=e._.dom||{},e._.dom.appendHtml=function(e,t){var n=document.createElement("div");for(n.innerHTML=t;n.children.length>0;)e.appendChild(n.children[0])}}(this),function(e){"use strict";e._=e._||{},e._.msg=e._.msg||{};var t=e._.msg;t.ids={modal:"modal",title:"modal-title",text:"modal-text"},t.errorUnsupportedFeature=function(){throw _.config.texts.errorFeatureNotImplemented},t.error=function(e){this._displayMessage("error",e)},t._displayMessage=function(e,t){var n=_.i18n.currentLanguage,a=_.config.translatedTexts[n][t];a||(a=t);var i=_.config.translatedTexts[n][_.config.texts.modalTitlePrefix+e];window.document.getElementById(this.ids.title).innerText=i,window.document.getElementById(this.ids.text).innerText=a,window.document.getElementById(this.ids.modal).style.display="block"},t.closeModal=function(){window.document.getElementById(this.ids.modal).style.display="none"},e.addEventListener&&e.addEventListener("error",function(e){_.msg.error(e.error.toString())})}(this),function(e){"use strict";e._=e._||{},e._.data=e._.data||{};var t=e._.data;t.get=function(e){if(this.lazyInitialisation(),!this.isLocalStorageAvailable)return null;var t=localStorage.getItem(e);if(null==t||"undefined"===t)return null;try{return JSON.parse(t)}catch(e){return t}},t.save=function(e,t){this.lazyInitialisation(),this.isLocalStorageAvailable&&("string"==typeof t?localStorage.setItem(e,t):localStorage.setItem(e,JSON.stringify(t)))};t.lazyInitialisation=function(){void 0===this.isLocalStorageAvailable&&(this.isLocalStorageAvailable=function(){try{var e=window.localStorage,t="__storage_test__";return e.setItem(t,t),e.removeItem(t),!0}catch(e){return!1}}())},t.initialize=function(){if(this.lazyInitialisation(),!this.isLocalStorageAvailable)throw _.config.texts.errorLocalstorageUnavailable}}(this),function(e){"use strict";e._=e._||{},e._.ajax=e._.ajax||{},e._.ajax.loadJson=function(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var e=JSON.parse(this.responseText);t(e)}},n.open("GET",e,!0),n.send()}}(this),function(e){"use strict";e._=e._||{},e._.i18n=e._.i18n||{};var t=e._.i18n;t.setLanguage=function(e){if(this.currentLanguage!==e){this.currentLanguage=e,_.data.save(_.config.storageKeys.savedLanguage,e),document.getElementsByTagName("html")[0].lang=e,document.getElementById("footer-lang-"+e).classList.add("hidden");for(var t=0;t<_.config.languages.supported.length;t++)e!==_.config.languages.supported[t]&&document.getElementById("footer-lang-"+_.config.languages.supported[t]).classList.remove("hidden");this._forceReloadStylesheetIfNeeded(e)}},t._forceReloadStylesheetIfNeeded=function(e){var t=document.getElementById("i18n-testDiv"),n=window.getComputedStyle(t,":before").getPropertyValue("content");n&&n==='"'+e+'"'||this._forceReloadStylesheet(e)},t._forceReloadStylesheet=function(e){var t="forceReloadStylesheets",n=document.getElementById(t),a=t+".css?"+e;n?n.href=a:_.dom.appendHtml(document.getElementsByTagName("head")[0],'<link id="'+t+'" rel="stylesheet" href="'+a+'">')},t.initialize=function(){if(!_.config)throw"config is unavailable";if(!_.data)throw"data is unavailable";var e=_.data.get(_.config.storageKeys.savedLanguage);if(e)this.setLanguage(e);else{for(var t,n=navigator.languages&&navigator.languages[0]||navigator.language||navigator.userLanguage,a=0;a<_.config.languages.supported.length;a++){var i=_.config.languages.supported[a];if(n===i||n.startsWith(i+"-")){t=i;break}}t||(t=this.defaultLanguage),this.setLanguage(t)}}}(this),function(e){"use strict";e._=e._||{},e._.route=e._.route||{};var t=e._.route,n=function(e){var t={};if(e){e.startsWith("?")&&(e=e.substr(1,e.length));var n,a=e.split("&");if(a)for(n=0;n<a.length;n++){var i=a[n].split("="),o=i[0],s=null;i.length>1&&(s=i[1]),t[o]=s}}return t},a=function(){var t,a,i,o=(t={},e.location&&e.location.search&&(t=n(e.location.search)),t),s=function(){var t={};if(e.location&&e.location.hash){var a=e.location.hash.split("?");a.length>1&&(t=n(a[1]))}return t}();return a=o,i=s,Object.keys(i).forEach(function(e){a[e]=i[e]}),a},i={adminMode:void 0},o=function(){var e=a(),t=Object.keys(e);i.adminMode=-1!==t.indexOf("admin")};e.onhashchange=function(){o(),t.onhashchange&&t.onhashchange()},t.isAdminMode=function(){return void 0===i.adminMode&&o(),i.adminMode}}(this),function(e,t){"use strict";for(var n=function(e,t){var n=document.getElementById("footer-language"),a=document.createElement("a");a.setAttribute("href","#"),a.setAttribute("id","footer-lang-"+e),a.setAttribute("hreflang",e),a.setAttribute("onClick","_.i18n.setLanguage('"+e+"');"),a.innerHTML='<span class="icon icon-globe"></span><span class="spanLang">&nbsp;'+t+"&nbsp;</span>";var i=n.firstChild;n.insertBefore(a,i)},a=e._.config.languages.supported,i=0;i<a.length;i++)n(a[i],e._.config.texts[a[i]])}(this),function(e,t){"use strict";var n=function(e,t){var n,a,i,o,s;if(t&&t.gamebooks)for(n=e,a=t.name,_.dom.appendHtml(document.getElementById(n),'<div class="pure-u-1"><h2>'+a+"</h2></div>"),i=0;i<t.gamebooks.length;i++)o=e,(s=t.gamebooks[i])&&_.dom.appendHtml(document.getElementById(o),'<div class="pure-u-1 pure-u-lg-1-3"><div class="margin-right"><a class="button u-full-width screen-gamebooks-book" href="../gamebook">'+s.name+"</a></div></div>")},a=function(){e._.route.isAdminMode()?document.getElementById("screen-gamebooks-adminBtn").classList.remove("hidden"):document.getElementById("screen-gamebooks-adminBtn").classList.add("hidden")};e._=e._||{},e._.screens=e._.screens||[],e._.screens.push(function(){document.getElementById(t)&&(e._.ajax.loadJson("../assets/data/library.json",function(e){!function(e){var a;for(a=0;a<e.length;a++)n(t,e[a])}(e)}),e._.route.onhashchange=a,a())})}(this,"screen-gamebooks-chooseAdventureDiv"),_.i18n.initialize(),_.data.initialize(),_.screens)for(i=0;i<_.screens.length;i++)_.screens[i]();